---
title: PageRank算法
date: 2018-2-22
tags: [PageRank, Google, Math]
mathjax: true
---

搜索引擎是现代互联网的基础设施之一，而网页排序则是搜索引擎的需要解决的核心问题。PageRank就是解决此问题的一个革命性的算法，Google用它来体现网页的相关性和重要性，在搜索引擎优化操作中是经常被用来评估网页优化的成效因素之一。

<!-- more -->

本文主要在简单介绍PageRank的算法模型，以及算法的缺陷和改进方法，来提高用户的搜索结果的满意度。

关键词：PageRank；搜索引擎；Google；排序算法。

#### PageRank 算法简介

最早的搜索引擎采用的是分类目录的方法，通过人工进行网页分类并整理出高质量的网站。那时 Yahoo 和国内的 hao123 就是使用的这种方法。后来网页越来越多，人工分类已经不现实了。搜索引擎进入了文本检索的时代，计算用户查询关键词与网页内容的相关程度来返回搜索结果。但是有些标题党的网页就会莫名的排名很靠前，影响搜索效果。

谷歌的两位创始人，当时还是美国斯坦福大学研究生的拉里·佩奇和谢尔盖·布林开始了对网页排序问题的研究，后来他们两个发明了PageRank算法，以拉里·佩奇（LarryPage）的名字来命名它，按照《数学之美》（吴军）中的说法，PageRank 的算法思想主要来自于拉里.佩奇，而谢尔盖·布林则将其转化为矩阵的迭代运算并证明其收敛性。

PageRank 算法的内容很简单，将整个互联网，看成一张有向图，网页是图上的点，链接是图上的有向边，每个网页都有一个得分，称作 PageRank，可以把它当成是一种投票权，将每一个超链接作为一次投票，每个网页的PageRank 等于所有具有指向该网页超链接的网页的 PageRank 的加权和这些权值等于这些网页各自向外链接数目的倒数。谷歌用它来体现网页的相关性和重要性，在搜索引擎优化操作中是经常被用来评估网页优化的成效因素之一。

#### PageRank算法原理

##### PageRank模型

互联网中众多的网页可以看成一张有向图，其中网页是一个节点，如果A网页中存在链接可以链接到B网页，则存在一条有向边A->B.

![pagerank1](http://image-1252432001.coscd.myqcloud.com/PageRank/pagerank1.jpg)

在上图中，如果正在浏览A网页，那么上网的人会各以1/3的概率跳到B，C，D网页，这里A有3个可以跳转的网页，同理可得，在D网页浏览的用户，到B，C网页的概率各位1/2，但是B到C的概率为0。在这里我们可以用概率转移矩阵表示用户跳转的概率，则可以得到上图的概率转移矩阵。
$$
M = \begin{bmatrix} 0 &1/2 & 0 & 1/2\\\\ 1/3 & 0 & 0 & 1/2\\\\ 1/3 & 1/2 & 0 & 0\\\\ 1/3&0&1&0 \end{bmatrix}
$$
在开始时，假设用户在每一个网页的概率都是相等的，概率为$\frac{1}{n}$,于是在开始时的概率分布就是一个所有值为$\frac{1}{n}$的n维列向量 ,用$V_0$右乘上矩阵M，其结果就是一步转移概率矩阵为 $V_1$  
$$
V_1=MV_0= \begin{bmatrix} 0&1/2&0&1/2\\\\ 1/3&0&0&1/2\\\\ 1/3&1/2&0&0\\\\  1/3&0&1&0 \end{bmatrix}  \begin{bmatrix} 1/4\\\\ 1/4\\\\ 1/4\\\\ 1/4 \end{bmatrix} =  \begin{bmatrix} 1/4\\\\ 5/24\\\\\ 5/24\\\\ 1/3 \end{bmatrix}
$$
这里的矩阵M中$M[i][j]$ 不为0表示一个链接从j指向i，在得到$V_1$后,再用$V_1$去右乘M，可以得到$V_2$,继续下去，最终V会收敛（假设图是强连通的），$V_n = MV_{n-1}$.

Matlab：

```matlab
format long;
M = [0,1/2,0,1/2;1/3,0,0,1/2;1/3,1/2,0,0;1/3,0,1,0];
V = [1/4;1/4;1/4;1/4];
% 开始迭代
times = 0;
while true
    check = V;
    V = M*V;
disp(V);
ifabs(check - V) < 1e-15
break;
end
    times = times + 1;
end
disp(times);

```

最终收敛于
$$
V_{76}= \begin{bmatrix} 0.264705882352941 \\\\ 0.235294117647058 \\\\ 0.205882352941176 \\\\ 0.294117647058823 \end{bmatrix} ≈ \begin{bmatrix} 1/4 \\\\ 1/4 \\\\ 1/5 \\\\ 1/4 \end{bmatrix}
$$
76步转移概率矩阵，也就是A网页相比于其他的网页更重要些，搜索引擎在对四个网页进行排序是C应该放在最上面。

#### 模型中的问题

##### 终止点问题（Dead Ends）

在上面的简单模型中有一个很重要的假设，就是上面的网页是不会终止的，也就是说，从任何一个网页就可以到达任意一个网页，即图是强连通的。只有这样最终会收敛。

但是在真是的互联网中的网页不满足强联通性，有的网页并不指向任何网页，当用户到达这样的网页，其概率会被清零，对上面的例子可以做下验证，将网页变成不指向任何网页的网页。

 ![pagerank2](http://image-1252432001.coscd.myqcloud.com/PageRank/pagerank2.jpg)

对应得转移矩阵为
$$
M= \begin{bmatrix} 0&1/2&0&0 \\\\ 1/3&0&0&0 \\\\ 1/3&1/2&0&0 \\\\ 1/3&0&1&0 \end{bmatrix} 
$$
仍然按上述的方法来迭代可以得到
$$
V_{831} =  \begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \end{bmatrix}
$$
在迭代831次后概率收敛于0.

##### 循环问题(Spider Trap)

循环问题，就是这网页没有指向任何其他的网页的链接，但是它存在指向自己的链接。如图

![pagerank3](http://image-1252432001.coscd.myqcloud.com/PageRank/pagerank3.jpg)

但用户到达D网页时，因为D指向自己，这是会陷入循环，最终全部的概率会全部分散到D网页上。

上图的转移概率矩阵为
$$
M = \begin{bmatrix} 0&1/2&0&0 \\\\ 1/3&0&0&0 \\\\ 1/3&1/2&0&0 \\\\ 1/3&0&1&1 \end{bmatrix}
$$
继续上述的迭代可得
$$
V_{40}=  \begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \end{bmatrix}
$$
迭代40次后收敛于0.

#### 模型问题解决

对于上面的问题，其实有很大的一个Bug，用户是聪明的，悠闲的，正常的，并不愚蠢。用户选择网页时随机的，当它遇到一个网页不认指向任何网页或者指向自己，用户有可能在地址栏中输入一个新的地址，从而浏览新的网页。

对算法的改进，用户可能都不想看当前网页了，不看当前网页也就不会点击

上面的链接，而是在地址栏输入另外一个地址，而在地址栏输入而跳转到各个网页的概率为1/n,假设用户查看当前网页的概率为$\alpha$，那么它从地址栏跳转的概率为$(1- \alpha)$,于是可以得到新的迭代函数
$$
V_n= \frac{α}{N}∙I+(1-α)M∙V_(n-1)
$$
利用迭代函数迭代计算带有循环问题的图的概率分布：
$$
V_1= \frac{α}{N}∙I+(1-α)M∙V_0= \begin{bmatrix} 0&1/2&0&0 \\\\ 1/3&0&0&0 \\\\ 1/3&1/2&0&0 \\\\ 1/3&0&1&1 \end{bmatrix} ×0.85+0.15× \begin{bmatrix} 1/4 \\\\ 1/4 \\\\ 1/4 \\\\ 1/4 \end{bmatrix}× \begin{bmatrix} 1/4 \\\\ 1/4 \\\\ 1/4 \\\\ 1/4 \end{bmatrix}
$$
这里令$\alpha = 0.15$ ,I是单位矩阵，这里的N=1/4，意思为网页的个数，迭代可以得到
$$
V_{32}=  \begin{bmatrix} 0.060753197536713 \\\\ 0.054713405968735 \\\\ 0.077966603505448 \\\\ 0.806566792989104 \end{bmatrix}
$$
最终迭代32次后,数值变化不大，收敛于$V_{32}$。

PageRank计算的是某个人在任意次链接点击后到达某一网页的可能性。如果某个网页拥有来自其他热门网页的外部链接越多，人们无意间到达该网页的可能性就会越大。当然，如果用户始终不停地点击，那么他们最终将到达每一个网页，但大多数人在浏览一段时间之后都会停止了点击。为了反映这一情况，PageRank还使用了一个值为0.85的阻尼因子，也就是上面模型中的参数 ,用以指示用户持续点击每个网页中链接的概率为85%。

#### 算法的缺点和改进

PageRank算法就是求Markov链的转移概率矩阵，再求其平稳分布，算法简单，但是效果是革命性的。

##### PageRank缺陷

PageRank算法也有很多的缺点，在真正的互联网中海量数据的计算是很困难的，网页排名的更新周期也会更长，从而也会影响搜索效果。

在对一些推广的网页，没有过滤广告链接和功能链接（例如“分享到微博”等），这些链接通常没有什么实际价值，前者链接到广告页面，后者常常链接到某个社交网站首页。

对新网页不友好。一个新网页的一般进入该网页的链接（外链）相对较少，即使它的内容的质量很高，要成为一个高PageRank值的页面仍需要很长时间的推广，也影响搜索的效果。

##### PageRank算法与作弊

如果我想让我的网站在搜索是排名靠前，不过如果我明白了PageRank主要靠内链数计算页面权重，一个页面会将权重均匀散播给被链接网站，所以除了内链数外，上游页面的权重也很重要，我要做的第一件事情就是尽量找一些PageRank较高的网页去加上对我网站首页的链接。例如我可以去微博，知乎等地方回个这样的贴：“楼主的帖子很不错！精彩内容：<http://XXXXXXXX>”，那么这些就在提高自己网站的PageRank值，也就是在作弊。

#### PageRank 改进

TrustRank，针对PageRank算法的缺点，有人提出了TrustRank算法，TrustRank算法的工作原理：先人工去识别高质量的页面，那么由这些高质量页面指向的页面也可能是高质量页面，即其TrustRank值也高，与这些页面的链接越远，页面的TrustRank值越低。这些页面可选出超链接数较多的网页，也可选PageRank值较高的网站。

TrustRank算法给出每个网页的TR值。将PageRank值与TrustRank值结合起来，可以更准确地判断网页的重要性。

#### 参考文献

[1] 吴军. 数学之美[M]. 北京:人民邮电出版社, 2014.

[2]（美）西格兰（Segaran,T,).集体编程智慧[M].北京:电子工业出版社,2015. 

[3]张波, 张景肖. 应用随机过程[M]. 北京:清华大学出版社, 2004.

[4]wikipedia. PageRank[EB/OL].https://en.wikipedia.org/wiki/PageRank.